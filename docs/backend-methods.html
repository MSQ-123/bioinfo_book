<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Backend methods | Bioinformatics in practice: web development, program optimization and integration</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Backend methods | Bioinformatics in practice: web development, program optimization and integration" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Backend methods | Bioinformatics in practice: web development, program optimization and integration" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Shaoqian Ma" />


<meta name="date" content="2021-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="possible-solutions-for-the-project.html"/>
<link rel="next" href="front-end-methods.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.10.20/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.10.20/js/dataTables.fixedColumns.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MSQ notebook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#purpose-for-writing"><i class="fa fa-check"></i><b>1.1</b> Purpose for writing</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-me"><i class="fa fa-check"></i><b>1.2</b> About me</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="possible-solutions-for-the-project.html"><a href="possible-solutions-for-the-project.html"><i class="fa fa-check"></i><b>3</b> Possible solutions for the project</a></li>
<li class="chapter" data-level="4" data-path="backend-methods.html"><a href="backend-methods.html"><i class="fa fa-check"></i><b>4</b> Backend methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="backend-methods.html"><a href="backend-methods.html#mysql-query"><i class="fa fa-check"></i><b>4.1</b> MySQL query</a></li>
<li class="chapter" data-level="4.2" data-path="backend-methods.html"><a href="backend-methods.html#springboot-in-java"><i class="fa fa-check"></i><b>4.2</b> SpringBoot in java</a></li>
<li class="chapter" data-level="4.3" data-path="backend-methods.html"><a href="backend-methods.html#merge-annotation-algorithm-writen-in-java"><i class="fa fa-check"></i><b>4.3</b> Merge, annotation algorithm writen in java</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="front-end-methods.html"><a href="front-end-methods.html"><i class="fa fa-check"></i><b>5</b> Front-end methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="front-end-methods.html"><a href="front-end-methods.html#introduction-of-shiny-framework"><i class="fa fa-check"></i><b>5.1</b> Introduction of Shiny framework</a></li>
<li class="chapter" data-level="5.2" data-path="front-end-methods.html"><a href="front-end-methods.html#vue.js-framework"><i class="fa fa-check"></i><b>5.2</b> Vue.js framework</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="recommended-resources.html"><a href="recommended-resources.html"><i class="fa fa-check"></i><b>6</b> Recommended resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bioinformatics in practice: web development, program optimization and integration</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="backend-methods" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Backend methods</h1>
<p>We describe our backend methods step by step in this chapter. We decided to use java platform as the middle-ware, which integrates SQL query, api testing and json data generation (api exposed to front-end).</p>
<div id="mysql-query" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> MySQL query</h2>
<p>The covid_annot table behind my shiny web is uploaded to MySQL database, total 16 columns (see below).</p>
<p>Consider that CovidShiny mainly focuses on querying data from the backend, the first thing to improve users experience and start our project is putting the large dataset in csv format in db (previously it was loaded into memory, which is unapplicable to production-grade app).</p>
<div id="htmlwidget-b50baac4580fe0eaa2d3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b50baac4580fe0eaa2d3">{"x":{"filter":"bottom","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"61\" data-max=\"7173\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"7\" data-max=\"7119\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["FixedColumns"],"data":[["hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23","hCoV-19/USA/CA-CDC-LC0053089/2021|EPI_ISL_1931711|2021-04-23"],[61,241,913,3037,3267,5023,5388,5986,6954,7173],["G","C","C","C","C","G","C","C","T","C"],["T","T","T","T","T","A","A","T","C","T"],[7,187,859,2983,3213,4969,5334,5932,6900,7119],[29695,29695,29695,29695,29695,29695,29695,29695,29695,29695],["5'UTR","5'UTR","NSP2","NSP3","NSP3","NSP3","NSP3","NSP3","NSP3","NSP3"],["61","241","S36S","F106F","T183I","M768I","A890D","F1089F","I1412T","S1485F"],["extragenic","extragenic","SNP_silent","SNP_silent","SNP","SNP","SNP","SNP_silent","SNP","SNP"],[null,null,"Non-Structural protein 2","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase","Predicted phosphoesterase, papain-like proteinase"],["5'UTR:61","5'UTR:241","NSP2:S36S","NSP3:F106F","NSP3:T183I","NSP3:M768I","NSP3:A890D","NSP3:F1089F","NSP3:I1412T","NSP3:S1485F"],["EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711","EPI_ISL_1931711"],["2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23","2021-04-23"],["G->T","C->T","C->T","C->T","C->T","G->A","C->A","C->T","T->C","C->T"],["61:G->T","241:C->T","913:C->T","3037:C->T","3267:C->T","5023:G->A","5388:C->A","5986:C->T","6954:T->C","7173:C->T"],["USA","USA","USA","USA","USA","USA","USA","USA","USA","USA"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>sample<\/th>\n      <th>refpos<\/th>\n      <th>refvar<\/th>\n      <th>qvar<\/th>\n      <th>qpos<\/th>\n      <th>qlength<\/th>\n      <th>protein<\/th>\n      <th>variant<\/th>\n      <th>varclass<\/th>\n      <th>annotation<\/th>\n      <th>pro_variant<\/th>\n      <th>ID<\/th>\n      <th>time<\/th>\n      <th>M_type<\/th>\n      <th>PM_type<\/th>\n      <th>country<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"fixedColumns":{"leftColumns":1},"autoWidth":false,"lengthMenu":[5,8,10],"columnDefs":[{"className":"dt-left","target":"_all"},{"className":"dt-right","targets":[1,4,5]}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Note: The dataset uploaded should be checked seriously just in case (some missing rows and <em>NA</em> in not-null column). Due to the high frequency of update, incremental id (corresponding to each unique mutation record of virus) column was set.</p>
<p>Next, I have to mention that the subset function used in my shiny framework can be pretty low-efficient when dealing large dataframe with up to hundreds of thousands rows (since R have to scanning the whole dataframe row by row to find all targets). So the subset syntax should be transformed into SQL query syntax (first in R, for test), for example:</p>
<p>From:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="backend-methods.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this example subset by country,M_type (with top frequency),</span></span>
<span id="cb2-2"><a href="backend-methods.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(country <span class="sc">!=</span> <span class="st">&quot;global&quot;</span>){</span>
<span id="cb2-3"><a href="backend-methods.html#cb2-3" aria-hidden="true" tabindex="-1"></a>covid_annot<span class="ot">&lt;-</span>covid_annot[covid_annot<span class="sc">$</span>country <span class="sc">==</span> country, ]</span>
<span id="cb2-4"><a href="backend-methods.html#cb2-4" aria-hidden="true" tabindex="-1"></a>      covid_annot<span class="ot">&lt;-</span> covid_annot[covid_annot<span class="sc">$</span>M_type <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">table</span>(covid_annot<span class="sc">$</span>M_type),<span class="at">decreasing=</span><span class="cn">TRUE</span>),<span class="at">n=</span>top)),]</span>
<span id="cb2-5"><a href="backend-methods.html#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="backend-methods.html#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="backend-methods.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(country <span class="sc">==</span> <span class="st">&quot;global&quot;</span>){</span>
<span id="cb2-8"><a href="backend-methods.html#cb2-8" aria-hidden="true" tabindex="-1"></a>      covid_annot<span class="ot">&lt;-</span> covid_annot[covid_annot<span class="sc">$</span>M_type <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">table</span>(covid_annot<span class="sc">$</span>M_type),<span class="at">decreasing=</span><span class="cn">TRUE</span>),<span class="at">n=</span>top)),]</span>
<span id="cb2-9"><a href="backend-methods.html#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>to:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="backend-methods.html#cb3-1" aria-hidden="true" tabindex="-1"></a>exec_sql_query_21<span class="ot">&lt;-</span><span class="cf">function</span>(conn,args_protein_list,args_country_list,order_M_type){</span>
<span id="cb3-2"><a href="backend-methods.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (args_country_list<span class="sc">==</span><span class="st">&#39;global&#39;</span>){  <span class="co">#global without force index, slow</span></span>
<span id="cb3-3"><a href="backend-methods.html#cb3-3" aria-hidden="true" tabindex="-1"></a>    sql_sentence <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">&quot;select sample, refpos, M_type from covid_annot \</span></span>
<span id="cb3-4"><a href="backend-methods.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">                        where M_type in (select M_type from (select M_type from covid_annot \</span></span>
<span id="cb3-5"><a href="backend-methods.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">                        where protein = &#39;{args_protein_list}&#39; \</span></span>
<span id="cb3-6"><a href="backend-methods.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">                        group by M_type order by count(M_type) DESC LIMIT {order_M_type})as t) \ </span></span>
<span id="cb3-7"><a href="backend-methods.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">                        and protein = &#39;{args_protein_list}&#39;&quot;</span>)</span>
<span id="cb3-8"><a href="backend-methods.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-9"><a href="backend-methods.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb3-10"><a href="backend-methods.html#cb3-10" aria-hidden="true" tabindex="-1"></a>    sql_sentence <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">&quot;select sample, refpos, M_type from covid_annot FORCE INDEX (country_index)\</span></span>
<span id="cb3-11"><a href="backend-methods.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">                        where M_type in (select M_type from (select M_type from covid_annot \</span></span>
<span id="cb3-12"><a href="backend-methods.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">                        where protein = &#39;{args_protein_list}&#39; and country = &#39;{args_country_list}&#39;\</span></span>
<span id="cb3-13"><a href="backend-methods.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">                        group by M_type order by count(M_type) DESC LIMIT {order_M_type})as t) \ </span></span>
<span id="cb3-14"><a href="backend-methods.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">                        and protein = &#39;{args_protein_list}&#39; and country = &#39;{args_country_list}&#39;&quot;</span>)</span>
<span id="cb3-15"><a href="backend-methods.html#cb3-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-16"><a href="backend-methods.html#cb3-16" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">dbSendQuery</span>(conn, sql_sentence) <span class="co"># read in </span></span>
<span id="cb3-17"><a href="backend-methods.html#cb3-17" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">fetch</span>(result, <span class="at">n =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="co"># return dataframe</span></span>
<span id="cb3-18"><a href="backend-methods.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb3-19"><a href="backend-methods.html#cb3-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-20"><a href="backend-methods.html#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="backend-methods.html#cb3-21" aria-hidden="true" tabindex="-1"></a>result_global_21<span class="ot">&lt;-</span><span class="fu">exec_sql_query_21</span>(my_conn,<span class="at">args_protein_list=</span><span class="st">&#39;S&#39;</span>,<span class="at">args_country_list=</span><span class="st">&#39;global&#39;</span>,<span class="at">order_M_type=</span><span class="st">&#39;3&#39;</span>)</span></code></pre></div>
<p>SQL sentences need to be optimized, in a few aspects:</p>
<ul>
<li><p>Use count command to summarize the data feature, such as mutations per sample, frequency of each mutation type, etc. We do this because if we always import a large dataset from MySQL to middle-ware to calculate the statistics, it may run into out of memory.</p></li>
<li><p>Construct index: We used forced index of country field, to faster M_type sorting (i.e., filter country first, then sort M_type).</p></li>
<li><p>Divide complex SQL sentence into sub-query, intermediate query results can be preserved in middle-ware (java).</p></li>
</ul>
<p>I made several intermediate files for the test of SQL query. With simple modifications, these SQL sentences can be easily translated into java code.</p>
</div>
<div id="springboot-in-java" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> SpringBoot in java</h2>
<p>The web framework is springboot, and we used swagger for api testing (from my perspective, the api testing is the most powerful part of java application, enabling separation of front-end and back-end. Shiny does not have this function).</p>
<div class="figure" style="text-align: center"><span id="fig:swagger-fig"></span>
<img src="images/swagger.png" alt="Swagger for best APIs" width="80%" />
<p class="caption">
Figure 4.1: Swagger for best APIs
</p>
</div>
<p>The json data returned by api (simulate GET, POST requests):</p>
<div class="figure" style="text-align: center"><span id="fig:api-fig"></span>
<img src="images/api_json.png" alt="APIs return json" width="80%" />
<p class="caption">
Figure 4.2: APIs return json
</p>
</div>
</div>
<div id="merge-annotation-algorithm-writen-in-java" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Merge, annotation algorithm writen in java</h2>
<p>The format of snps records output by nucmer script:</p>
<div id="htmlwidget-7693ae33d08b3d83dbd6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7693ae33d08b3d83dbd6">{"x":{"filter":"bottom","filterHTML":"<tr>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"5\" data-max=\"16\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"5\" data-max=\"16\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"4\" data-max=\"16\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"5\" data-max=\"16\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"29851\" data-max=\"29919\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["FixedColumns"],"data":[[5,10,10,12,13,13,14,15,15,16],[".","T","T","A","T","T","A","C","C","C"],["T","A","A","G","A","C","G","T","T","A"],[5,10,7,12,13,11,14,15,15,16],[4,4,7,12,13,11,7,4,15,16],[5,10,7,12,13,11,14,15,15,16],[254,254,254,254,254,254,254,254,254,254],[0,0,0,0,0,0,0,0,0,0],[29903,29903,29903,29903,29903,29903,29903,29903,29903,29903],[29851,29869,29897,29903,29903,29919,29852,29903,29891,29866],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],["Untitled","Untitled","Untitled","Untitled","Untitled","Untitled","Untitled","Untitled","Untitled","Untitled"],["hCoV-19/Chile/Punta_Arenas_5/2020|EPI_ISL_445283|2020-03-19","hCoV-19/France/IDF2251/2020|EPI_ISL_428355|2020-03-11","hCoV-19/USA/WA-UW126/2020|EPI_ISL_416664|2020-03-12","hCoV-19/Brazil/PA164173-IEC/2020|EPI_ISL_458146|2020-04-23","hCoV-19/France/HF1993/2020|EPI_ISL_414637|2020-03-04","hCoV-19/USA/WA-UW-10129/2020|EPI_ISL_461473|2020-05-29","hCoV-19/Chile/Punta_Arenas_1/2020|EPI_ISL_445268|2020-03-14","hCoV-19/Italy/TE6195/2020|EPI_ISL_420569|2020-03-23","hCoV-19/env/Wuhan/IVDC-HBF13-20/2020|EPI_ISL_408514|2020-01-01","hCoV-19/India/NCDC-3394/2020|EPI_ISL_436435|2020-04-09"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>rpos<\/th>\n      <th>rvar<\/th>\n      <th>qvar<\/th>\n      <th>qpos<\/th>\n      <th><\/th>\n      <th><\/th>\n      <th><\/th>\n      <th><\/th>\n      <th>rlength<\/th>\n      <th>qlength<\/th>\n      <th><\/th>\n      <th><\/th>\n      <th>rname<\/th>\n      <th>qname<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"autoWidth":false,"lengthMenu":[5,8,10],"columnDefs":[{"className":"dt-left","target":"_all"},{"className":"dt-right","targets":[0,3,4,5,6,7,8,9,10,11]}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Each row represents a single mutation record. However, some mutations are contiguous (e.g, 121:C -&gt; T, 122:A -&gt; C, 123:G -&gt; A). Also, contiguous mutations in some cases can be identified as deletions or insertions. For convenience (also save memory, reduce rows in the dataframe), I merged contiguous mutations into single records, rendering merged nucmer data, making it easy to annotate deletion and insertion events.</p>
<p>I followed the code written by other publications<span class="citation">(<a href="#ref-Mercatelli2020" role="doc-biblioref">Mercatelli and Giorgi 2020</a>)</span>. I interpreted this tedious code and expressed the core idea to an algorithm engineer.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="backend-methods.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Merge neighboring events ----</span></span>
<span id="cb4-2"><a href="backend-methods.html#cb4-2" aria-hidden="true" tabindex="-1"></a>samples<span class="ot">&lt;-</span><span class="fu">unique</span>(nucmer<span class="sc">$</span>qname)</span>
<span id="cb4-3"><a href="backend-methods.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(samples) <span class="co"># 12822</span></span>
<span id="cb4-4"><a href="backend-methods.html#cb4-4" aria-hidden="true" tabindex="-1"></a>pb<span class="ot">&lt;-</span><span class="fu">txtProgressBar</span>(<span class="dv">0</span>,<span class="fu">length</span>(samples),<span class="at">style=</span><span class="dv">3</span>)</span>
<span id="cb4-5"><a href="backend-methods.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pbi <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(samples)){ <span class="co"># This will update the nucmer object, deal with each sample records</span></span>
<span id="cb4-6"><a href="backend-methods.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  sample<span class="ot">&lt;-</span>samples[pbi]</span>
<span id="cb4-7"><a href="backend-methods.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  allvars<span class="ot">&lt;-</span>nucmer[nucmer<span class="sc">$</span>qname<span class="sc">==</span>sample,]</span>
<span id="cb4-8"><a href="backend-methods.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  snps<span class="ot">&lt;-</span>allvars[(allvars[,<span class="st">&quot;rvar&quot;</span>]<span class="sc">!=</span><span class="st">&quot;.&quot;</span>)<span class="sc">&amp;</span>(allvars[,<span class="st">&quot;qvar&quot;</span>]<span class="sc">!=</span><span class="st">&quot;.&quot;</span>),]</span>
<span id="cb4-9"><a href="backend-methods.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  inss<span class="ot">&lt;-</span>allvars[(allvars[,<span class="st">&quot;rvar&quot;</span>]<span class="sc">==</span><span class="st">&quot;.&quot;</span>),]</span>
<span id="cb4-10"><a href="backend-methods.html#cb4-10" aria-hidden="true" tabindex="-1"></a>  dels<span class="ot">&lt;-</span>allvars[(allvars[,<span class="st">&quot;qvar&quot;</span>]<span class="sc">==</span><span class="st">&quot;.&quot;</span>),]</span>
<span id="cb4-11"><a href="backend-methods.html#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge insertions</span></span>
<span id="cb4-12"><a href="backend-methods.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  prevqpos<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-13"><a href="backend-methods.html#cb4-13" aria-hidden="true" tabindex="-1"></a>  prevrowname<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb4-14"><a href="backend-methods.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  remove<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb4-15"><a href="backend-methods.html#cb4-15" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb4-16"><a href="backend-methods.html#cb4-16" aria-hidden="true" tabindex="-1"></a>  corrector<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-17"><a href="backend-methods.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="fu">nrow</span>(inss)){</span>
<span id="cb4-18"><a href="backend-methods.html#cb4-18" aria-hidden="true" tabindex="-1"></a>    rpos<span class="ot">&lt;-</span>inss[i,<span class="st">&quot;rpos&quot;</span>]</span>
<span id="cb4-19"><a href="backend-methods.html#cb4-19" aria-hidden="true" tabindex="-1"></a>    rvar<span class="ot">&lt;-</span>inss[i,<span class="st">&quot;rvar&quot;</span>]</span>
<span id="cb4-20"><a href="backend-methods.html#cb4-20" aria-hidden="true" tabindex="-1"></a>    qvar<span class="ot">&lt;-</span>inss[i,<span class="st">&quot;qvar&quot;</span>]</span>
<span id="cb4-21"><a href="backend-methods.html#cb4-21" aria-hidden="true" tabindex="-1"></a>    qpos<span class="ot">&lt;-</span>inss[i,<span class="st">&quot;qpos&quot;</span>]</span>
<span id="cb4-22"><a href="backend-methods.html#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>((qpos<span class="sc">!=</span><span class="dv">1</span>)<span class="sc">&amp;</span>(qpos<span class="sc">==</span>(prevqpos<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>corrector))){</span>
<span id="cb4-23"><a href="backend-methods.html#cb4-23" aria-hidden="true" tabindex="-1"></a>      inss<span class="ot">&lt;-</span>inss[<span class="sc">-</span>i,]</span>
<span id="cb4-24"><a href="backend-methods.html#cb4-24" aria-hidden="true" tabindex="-1"></a>      inss[prevrowname,<span class="st">&quot;qvar&quot;</span>]<span class="ot">&lt;-</span><span class="fu">paste0</span>(inss[prevrowname,<span class="st">&quot;qvar&quot;</span>],qvar)</span>
<span id="cb4-25"><a href="backend-methods.html#cb4-25" aria-hidden="true" tabindex="-1"></a>      corrector<span class="ot">&lt;-</span>corrector<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-26"><a href="backend-methods.html#cb4-26" aria-hidden="true" tabindex="-1"></a>      i<span class="ot">&lt;-</span>i<span class="dv">-1</span></span>
<span id="cb4-27"><a href="backend-methods.html#cb4-27" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-28"><a href="backend-methods.html#cb4-28" aria-hidden="true" tabindex="-1"></a>      corrector<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-29"><a href="backend-methods.html#cb4-29" aria-hidden="true" tabindex="-1"></a>      prevrowname<span class="ot">&lt;-</span><span class="fu">rownames</span>(inss)[i]</span>
<span id="cb4-30"><a href="backend-methods.html#cb4-30" aria-hidden="true" tabindex="-1"></a>      prevqpos<span class="ot">&lt;-</span>qpos</span>
<span id="cb4-31"><a href="backend-methods.html#cb4-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-32"><a href="backend-methods.html#cb4-32" aria-hidden="true" tabindex="-1"></a>    i<span class="ot">&lt;-</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-33"><a href="backend-methods.html#cb4-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-34"><a href="backend-methods.html#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge deletions</span></span>
<span id="cb4-35"><a href="backend-methods.html#cb4-35" aria-hidden="true" tabindex="-1"></a>  prevqpos<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-36"><a href="backend-methods.html#cb4-36" aria-hidden="true" tabindex="-1"></a>  prevrowname<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb4-37"><a href="backend-methods.html#cb4-37" aria-hidden="true" tabindex="-1"></a>  remove<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb4-38"><a href="backend-methods.html#cb4-38" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb4-39"><a href="backend-methods.html#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="fu">nrow</span>(dels)){</span>
<span id="cb4-40"><a href="backend-methods.html#cb4-40" aria-hidden="true" tabindex="-1"></a>    rpos<span class="ot">&lt;-</span>dels[i,<span class="st">&quot;rpos&quot;</span>]</span>
<span id="cb4-41"><a href="backend-methods.html#cb4-41" aria-hidden="true" tabindex="-1"></a>    rvar<span class="ot">&lt;-</span>dels[i,<span class="st">&quot;rvar&quot;</span>]</span>
<span id="cb4-42"><a href="backend-methods.html#cb4-42" aria-hidden="true" tabindex="-1"></a>    qvar<span class="ot">&lt;-</span>dels[i,<span class="st">&quot;qvar&quot;</span>]</span>
<span id="cb4-43"><a href="backend-methods.html#cb4-43" aria-hidden="true" tabindex="-1"></a>    qpos<span class="ot">&lt;-</span>dels[i,<span class="st">&quot;qpos&quot;</span>]</span>
<span id="cb4-44"><a href="backend-methods.html#cb4-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-45"><a href="backend-methods.html#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>((qpos<span class="sc">!=</span><span class="dv">1</span>)<span class="sc">&amp;</span>(qpos<span class="sc">==</span>(prevqpos))){</span>
<span id="cb4-46"><a href="backend-methods.html#cb4-46" aria-hidden="true" tabindex="-1"></a>      dels<span class="ot">&lt;-</span>dels[<span class="sc">-</span>i,]</span>
<span id="cb4-47"><a href="backend-methods.html#cb4-47" aria-hidden="true" tabindex="-1"></a>      dels[prevrowname,<span class="st">&quot;rvar&quot;</span>]<span class="ot">&lt;-</span><span class="fu">paste0</span>(dels[prevrowname,<span class="st">&quot;rvar&quot;</span>],rvar)</span>
<span id="cb4-48"><a href="backend-methods.html#cb4-48" aria-hidden="true" tabindex="-1"></a>      i<span class="ot">&lt;-</span>i<span class="dv">-1</span></span>
<span id="cb4-49"><a href="backend-methods.html#cb4-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-50"><a href="backend-methods.html#cb4-50" aria-hidden="true" tabindex="-1"></a>      prevrowname<span class="ot">&lt;-</span><span class="fu">rownames</span>(dels)[i]</span>
<span id="cb4-51"><a href="backend-methods.html#cb4-51" aria-hidden="true" tabindex="-1"></a>      prevqpos<span class="ot">&lt;-</span>qpos</span>
<span id="cb4-52"><a href="backend-methods.html#cb4-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-53"><a href="backend-methods.html#cb4-53" aria-hidden="true" tabindex="-1"></a>    i<span class="ot">&lt;-</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-54"><a href="backend-methods.html#cb4-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-55"><a href="backend-methods.html#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge SNPs</span></span>
<span id="cb4-56"><a href="backend-methods.html#cb4-56" aria-hidden="true" tabindex="-1"></a>  prevqpos<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-57"><a href="backend-methods.html#cb4-57" aria-hidden="true" tabindex="-1"></a>  prevrowname<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb4-58"><a href="backend-methods.html#cb4-58" aria-hidden="true" tabindex="-1"></a>  remove<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb4-59"><a href="backend-methods.html#cb4-59" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb4-60"><a href="backend-methods.html#cb4-60" aria-hidden="true" tabindex="-1"></a>  corrector<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-61"><a href="backend-methods.html#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="fu">nrow</span>(snps)){</span>
<span id="cb4-62"><a href="backend-methods.html#cb4-62" aria-hidden="true" tabindex="-1"></a>    rpos<span class="ot">&lt;-</span>snps[i,<span class="st">&quot;rpos&quot;</span>]</span>
<span id="cb4-63"><a href="backend-methods.html#cb4-63" aria-hidden="true" tabindex="-1"></a>    rvar<span class="ot">&lt;-</span>snps[i,<span class="st">&quot;rvar&quot;</span>]</span>
<span id="cb4-64"><a href="backend-methods.html#cb4-64" aria-hidden="true" tabindex="-1"></a>    qvar<span class="ot">&lt;-</span>snps[i,<span class="st">&quot;qvar&quot;</span>]</span>
<span id="cb4-65"><a href="backend-methods.html#cb4-65" aria-hidden="true" tabindex="-1"></a>    qpos<span class="ot">&lt;-</span>snps[i,<span class="st">&quot;qpos&quot;</span>]</span>
<span id="cb4-66"><a href="backend-methods.html#cb4-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-67"><a href="backend-methods.html#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>((qpos<span class="sc">!=</span><span class="dv">1</span>)<span class="sc">&amp;</span>(qpos<span class="sc">==</span>(prevqpos<span class="sc">+</span><span class="dv">1</span><span class="sc">+</span>corrector))){</span>
<span id="cb4-68"><a href="backend-methods.html#cb4-68" aria-hidden="true" tabindex="-1"></a>      snps<span class="ot">&lt;-</span>snps[<span class="sc">-</span>i,]</span>
<span id="cb4-69"><a href="backend-methods.html#cb4-69" aria-hidden="true" tabindex="-1"></a>      snps[prevrowname,<span class="st">&quot;rvar&quot;</span>]<span class="ot">&lt;-</span><span class="fu">paste0</span>(snps[prevrowname,<span class="st">&quot;rvar&quot;</span>],rvar)</span>
<span id="cb4-70"><a href="backend-methods.html#cb4-70" aria-hidden="true" tabindex="-1"></a>      snps[prevrowname,<span class="st">&quot;qvar&quot;</span>]<span class="ot">&lt;-</span><span class="fu">paste0</span>(snps[prevrowname,<span class="st">&quot;qvar&quot;</span>],qvar)</span>
<span id="cb4-71"><a href="backend-methods.html#cb4-71" aria-hidden="true" tabindex="-1"></a>      corrector<span class="ot">&lt;-</span>corrector<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-72"><a href="backend-methods.html#cb4-72" aria-hidden="true" tabindex="-1"></a>      i<span class="ot">&lt;-</span>i<span class="dv">-1</span></span>
<span id="cb4-73"><a href="backend-methods.html#cb4-73" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-74"><a href="backend-methods.html#cb4-74" aria-hidden="true" tabindex="-1"></a>      corrector<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb4-75"><a href="backend-methods.html#cb4-75" aria-hidden="true" tabindex="-1"></a>      prevrowname<span class="ot">&lt;-</span><span class="fu">rownames</span>(snps)[i]</span>
<span id="cb4-76"><a href="backend-methods.html#cb4-76" aria-hidden="true" tabindex="-1"></a>      prevqpos<span class="ot">&lt;-</span>qpos</span>
<span id="cb4-77"><a href="backend-methods.html#cb4-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-78"><a href="backend-methods.html#cb4-78" aria-hidden="true" tabindex="-1"></a>    i<span class="ot">&lt;-</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-79"><a href="backend-methods.html#cb4-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-80"><a href="backend-methods.html#cb4-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-81"><a href="backend-methods.html#cb4-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remerge back</span></span>
<span id="cb4-82"><a href="backend-methods.html#cb4-82" aria-hidden="true" tabindex="-1"></a>  allvars2<span class="ot">&lt;-</span><span class="fu">rbind</span>(snps,inss,dels)</span>
<span id="cb4-83"><a href="backend-methods.html#cb4-83" aria-hidden="true" tabindex="-1"></a>  remove<span class="ot">&lt;-</span><span class="fu">setdiff</span>(<span class="fu">rownames</span>(allvars),<span class="fu">rownames</span>(allvars2))<span class="co">#?setdiff</span></span>
<span id="cb4-84"><a href="backend-methods.html#cb4-84" aria-hidden="true" tabindex="-1"></a>  nucmer<span class="ot">&lt;-</span>nucmer[<span class="fu">setdiff</span>(<span class="fu">rownames</span>(nucmer),remove),]</span>
<span id="cb4-85"><a href="backend-methods.html#cb4-85" aria-hidden="true" tabindex="-1"></a>  nucmer[<span class="fu">rownames</span>(allvars2),]<span class="ot">&lt;-</span>allvars2</span>
<span id="cb4-86"><a href="backend-methods.html#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setTxtProgressBar</span>(pb,pbi)</span>
<span id="cb4-87"><a href="backend-methods.html#cb4-87" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This chunk of code has several problems:</p>
<ul>
<li>Subsetting mutation records of each sample means exhaustive search, which will scan all rows in each for-loop. When it comes to solve hundreds of thousands rows, this algorithm can be extremely time-consuming.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="backend-methods.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This subsets all records of each sample </span></span>
<span id="cb5-2"><a href="backend-methods.html#cb5-2" aria-hidden="true" tabindex="-1"></a>allvars<span class="ot">&lt;-</span>nucmer[nucmer<span class="sc">$</span>qname<span class="sc">==</span>sample,]</span></code></pre></div>
<ul>
<li>Each sample can be processed independently. However, the above code does not involve concurrency.</li>
</ul>
<p>To solve these problem, we rewrote the code into java, which supports concurrency easily:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="backend-methods.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-2"><a href="backend-methods.html#cb6-2" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> first group and sort records by sample name<span class="co">,</span> mutation type <span class="co">(</span>insertion<span class="co">,</span> deletion<span class="co">,</span> snp<span class="co">),</span> qpos<span class="co">,</span> rpos<span class="co">,</span> so java only needs to merge records in order<span class="co">,</span> without tedious subsetting<span class="co">.</span></span>
<span id="cb6-3"><a href="backend-methods.html#cb6-3" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span></span>
<span id="cb6-4"><a href="backend-methods.html#cb6-4" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>param ses</span>
<span id="cb6-5"><a href="backend-methods.html#cb6-5" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>return</span>
<span id="cb6-6"><a href="backend-methods.html#cb6-6" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb6-7"><a href="backend-methods.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>SnpsEntity<span class="op">&gt;</span> <span class="fu">mergeQpos</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>SnpsEntity<span class="op">&gt;</span> ses<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-8"><a href="backend-methods.html#cb6-8" aria-hidden="true" tabindex="-1"></a>        ses<span class="op">.</span><span class="fu">sort</span><span class="op">((</span>o1<span class="op">,</span> o2<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb6-9"><a href="backend-methods.html#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>StrUtil<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getQ_name</span><span class="op">()))</span></span>
<span id="cb6-10"><a href="backend-methods.html#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> StrUtil<span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb6-11"><a href="backend-methods.html#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>o1<span class="op">.</span><span class="fu">getType</span><span class="op">()</span> <span class="op">!=</span> o2<span class="op">.</span><span class="fu">getType</span><span class="op">())</span></span>
<span id="cb6-12"><a href="backend-methods.html#cb6-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getType</span><span class="op">().</span><span class="fu">ordinal</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getType</span><span class="op">().</span><span class="fu">ordinal</span><span class="op">());</span></span>
<span id="cb6-13"><a href="backend-methods.html#cb6-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_pos</span><span class="op">()</span> <span class="op">!=</span> o1<span class="op">.</span><span class="fu">getQ_pos</span><span class="op">())</span></span>
<span id="cb6-14"><a href="backend-methods.html#cb6-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_pos</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getQ_pos</span><span class="op">());</span></span>
<span id="cb6-15"><a href="backend-methods.html#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getR_pos</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getR_pos</span><span class="op">());</span></span>
<span id="cb6-16"><a href="backend-methods.html#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb6-17"><a href="backend-methods.html#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="backend-methods.html#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">List</span><span class="op">&lt;</span>SnpsEntity<span class="op">&gt;</span> ans <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb6-19"><a href="backend-methods.html#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> j<span class="op">;</span> i <span class="op">&lt;</span> ses<span class="op">.</span><span class="fu">size</span><span class="op">();</span> i <span class="op">=</span> j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-20"><a href="backend-methods.html#cb6-20" aria-hidden="true" tabindex="-1"></a>            SnpsEntity se <span class="op">=</span> ses<span class="op">.</span><span class="fu">get</span><span class="op">(</span>i<span class="op">);</span></span>
<span id="cb6-21"><a href="backend-methods.html#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">boolean</span> dbg <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-22"><a href="backend-methods.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">//             dbg = se.getR_pos() == 28280 &amp;&amp; StrUtil.equals(se.getQ_name(),</span></span>
<span id="cb6-23"><a href="backend-methods.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">//                    &quot;hCoV-19/Germany/un-RKI-I-112884/2021|EPI_ISL_1977817|2021-04-23&quot;);</span></span>
<span id="cb6-24"><a href="backend-methods.html#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>dbg<span class="op">)</span></span>
<span id="cb6-25"><a href="backend-methods.html#cb6-25" aria-hidden="true" tabindex="-1"></a>                <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>se<span class="op">);</span></span>
<span id="cb6-26"><a href="backend-methods.html#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="backend-methods.html#cb6-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span>j <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> ses<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&amp;&amp;</span> ses<span class="op">.</span><span class="fu">get</span><span class="op">(</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">).</span><span class="fu">canMerge</span><span class="op">(</span>ses<span class="op">.</span><span class="fu">get</span><span class="op">(</span>j<span class="op">));</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-28"><a href="backend-methods.html#cb6-28" aria-hidden="true" tabindex="-1"></a>                var sj <span class="op">=</span> ses<span class="op">.</span><span class="fu">get</span><span class="op">(</span>j<span class="op">);</span></span>
<span id="cb6-29"><a href="backend-methods.html#cb6-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>dbg<span class="op">)</span></span>
<span id="cb6-30"><a href="backend-methods.html#cb6-30" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span>sj<span class="op">);</span></span>
<span id="cb6-31"><a href="backend-methods.html#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="backend-methods.html#cb6-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>se<span class="op">.</span><span class="fu">getType</span><span class="op">()</span> <span class="op">==</span> SnpsType<span class="op">.</span><span class="fu">INS</span><span class="op">)</span></span>
<span id="cb6-33"><a href="backend-methods.html#cb6-33" aria-hidden="true" tabindex="-1"></a>                    se<span class="op">.</span><span class="fu">setQ_var</span><span class="op">(</span>se<span class="op">.</span><span class="fu">getQ_var</span><span class="op">()</span> <span class="op">+</span> sj<span class="op">.</span><span class="fu">getQ_var</span><span class="op">());</span></span>
<span id="cb6-34"><a href="backend-methods.html#cb6-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>se<span class="op">.</span><span class="fu">getType</span><span class="op">()</span> <span class="op">==</span> SnpsType<span class="op">.</span><span class="fu">DEL</span><span class="op">)</span></span>
<span id="cb6-35"><a href="backend-methods.html#cb6-35" aria-hidden="true" tabindex="-1"></a>                    se<span class="op">.</span><span class="fu">setR_var</span><span class="op">(</span>se<span class="op">.</span><span class="fu">getR_var</span><span class="op">()</span> <span class="op">+</span> sj<span class="op">.</span><span class="fu">getR_var</span><span class="op">());</span></span>
<span id="cb6-36"><a href="backend-methods.html#cb6-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-37"><a href="backend-methods.html#cb6-37" aria-hidden="true" tabindex="-1"></a>                    se<span class="op">.</span><span class="fu">setR_var</span><span class="op">(</span>se<span class="op">.</span><span class="fu">getR_var</span><span class="op">()</span> <span class="op">+</span> sj<span class="op">.</span><span class="fu">getR_var</span><span class="op">());</span></span>
<span id="cb6-38"><a href="backend-methods.html#cb6-38" aria-hidden="true" tabindex="-1"></a>                    se<span class="op">.</span><span class="fu">setQ_var</span><span class="op">(</span>se<span class="op">.</span><span class="fu">getQ_var</span><span class="op">()</span> <span class="op">+</span> sj<span class="op">.</span><span class="fu">getQ_var</span><span class="op">());</span></span>
<span id="cb6-39"><a href="backend-methods.html#cb6-39" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb6-40"><a href="backend-methods.html#cb6-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-41"><a href="backend-methods.html#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="backend-methods.html#cb6-42" aria-hidden="true" tabindex="-1"></a>            ans<span class="op">.</span><span class="fu">add</span><span class="op">(</span>se<span class="op">);</span></span>
<span id="cb6-43"><a href="backend-methods.html#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-44"><a href="backend-methods.html#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="backend-methods.html#cb6-45" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">.</span><span class="fu">sort</span><span class="op">((</span>o1<span class="op">,</span> o2<span class="op">)</span> <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb6-46"><a href="backend-methods.html#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>StrUtil<span class="op">.</span><span class="fu">equals</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getQ_name</span><span class="op">()))</span></span>
<span id="cb6-47"><a href="backend-methods.html#cb6-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> StrUtil<span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getQ_name</span><span class="op">(),</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb6-48"><a href="backend-methods.html#cb6-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">Integer</span><span class="op">.</span><span class="fu">compare</span><span class="op">(</span>o1<span class="op">.</span><span class="fu">getR_pos</span><span class="op">(),</span> o2<span class="op">.</span><span class="fu">getR_pos</span><span class="op">());</span></span>
<span id="cb6-49"><a href="backend-methods.html#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb6-50"><a href="backend-methods.html#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="backend-methods.html#cb6-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ans<span class="op">;</span></span>
<span id="cb6-52"><a href="backend-methods.html#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-53"><a href="backend-methods.html#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>In java code, it ordered records first and traversed each record once (without subset function), saving a lot time when dealing with large dataset.</p>
<p>The annotation process in R:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="backend-methods.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Provide effect of each SNP and indel ----</span></span>
<span id="cb7-2"><a href="backend-methods.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#header&lt;-c(&quot;sample&quot;,&quot;refpos&quot;,&quot;refvar&quot;,&quot;qvar&quot;,&quot;qlength&quot;,&quot;qpos&quot;,&quot;protein&quot;,&quot;variant&quot;,&quot;varclass&quot;,&quot;annotation&quot;)</span></span>
<span id="cb7-3"><a href="backend-methods.html#cb7-3" aria-hidden="true" tabindex="-1"></a>header<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>,<span class="st">&quot;refpos&quot;</span>,<span class="st">&quot;refvar&quot;</span>,<span class="st">&quot;qvar&quot;</span>,<span class="st">&quot;qpos&quot;</span>,<span class="st">&quot;qlength&quot;</span>,<span class="st">&quot;protein&quot;</span>,<span class="st">&quot;variant&quot;</span>,<span class="st">&quot;varclass&quot;</span>,<span class="st">&quot;annotation&quot;</span>)</span>
<span id="cb7-4"><a href="backend-methods.html#cb7-4" aria-hidden="true" tabindex="-1"></a>results<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">ncol=</span><span class="fu">length</span>(header),<span class="at">nrow=</span><span class="dv">0</span>)</span>
<span id="cb7-5"><a href="backend-methods.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(results)<span class="ot">&lt;-</span>header</span>
<span id="cb7-6"><a href="backend-methods.html#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="backend-methods.html#cb7-7" aria-hidden="true" tabindex="-1"></a>samples<span class="ot">&lt;-</span><span class="fu">unique</span>(nucmer<span class="sc">$</span>qname)</span>
<span id="cb7-8"><a href="backend-methods.html#cb7-8" aria-hidden="true" tabindex="-1"></a>pb<span class="ot">&lt;-</span><span class="fu">txtProgressBar</span>(<span class="dv">0</span>,<span class="fu">length</span>(samples),<span class="at">style=</span><span class="dv">3</span>)</span>
<span id="cb7-9"><a href="backend-methods.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pbi <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(samples)){ <span class="co"># This will update the nucmer object</span></span>
<span id="cb7-10"><a href="backend-methods.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  sample<span class="ot">&lt;-</span>samples[pbi]</span>
<span id="cb7-11"><a href="backend-methods.html#cb7-11" aria-hidden="true" tabindex="-1"></a>  allvars<span class="ot">&lt;-</span>nucmer[nucmer<span class="sc">$</span>qname<span class="sc">==</span>sample,]</span>
<span id="cb7-12"><a href="backend-methods.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check changes in query protein sequence according to variants</span></span>
<span id="cb7-13"><a href="backend-methods.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(allvars)){ <span class="co"># Assuming they are sorted numerically</span></span>
<span id="cb7-14"><a href="backend-methods.html#cb7-14" aria-hidden="true" tabindex="-1"></a>    nucline<span class="ot">&lt;-</span>allvars[i,]</span>
<span id="cb7-15"><a href="backend-methods.html#cb7-15" aria-hidden="true" tabindex="-1"></a>    rpos<span class="ot">&lt;-</span>nucline[<span class="dv">1</span>,<span class="st">&quot;rpos&quot;</span>]</span>
<span id="cb7-16"><a href="backend-methods.html#cb7-16" aria-hidden="true" tabindex="-1"></a>    rvar<span class="ot">&lt;-</span>nucline[<span class="dv">1</span>,<span class="st">&quot;rvar&quot;</span>]</span>
<span id="cb7-17"><a href="backend-methods.html#cb7-17" aria-hidden="true" tabindex="-1"></a>    qvar<span class="ot">&lt;-</span>nucline[<span class="dv">1</span>,<span class="st">&quot;qvar&quot;</span>]</span>
<span id="cb7-18"><a href="backend-methods.html#cb7-18" aria-hidden="true" tabindex="-1"></a>    qpos<span class="ot">&lt;-</span>nucline[<span class="dv">1</span>,<span class="st">&quot;qpos&quot;</span>]</span>
<span id="cb7-19"><a href="backend-methods.html#cb7-19" aria-hidden="true" tabindex="-1"></a>    qlength<span class="ot">&lt;-</span>nucline[<span class="dv">1</span>,<span class="st">&quot;qlength&quot;</span>]</span>
<span id="cb7-20"><a href="backend-methods.html#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="backend-methods.html#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Match over GFF3 annotation   for each var in a sample: match the var with the GFF3 </span></span>
<span id="cb7-22"><a href="backend-methods.html#cb7-22" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">&lt;-</span>rpos<span class="sc">-</span>gff3[,<span class="dv">4</span>]</span>
<span id="cb7-23"><a href="backend-methods.html#cb7-23" aria-hidden="true" tabindex="-1"></a>    b<span class="ot">&lt;-</span>rpos<span class="sc">-</span>gff3[,<span class="dv">5</span>]</span>
<span id="cb7-24"><a href="backend-methods.html#cb7-24" aria-hidden="true" tabindex="-1"></a>    signs<span class="ot">&lt;-</span><span class="fu">sign</span>(a)<span class="sc">*</span><span class="fu">sign</span>(b)</span>
<span id="cb7-25"><a href="backend-methods.html#cb7-25" aria-hidden="true" tabindex="-1"></a>    w<span class="ot">&lt;-</span><span class="fu">which</span>(signs<span class="sc">==-</span><span class="dv">1</span>)<span class="co">#if signs == -1 then  rpos in GFF anno </span></span>
<span id="cb7-26"><a href="backend-methods.html#cb7-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-27"><a href="backend-methods.html#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outside genes scenarios</span></span>
<span id="cb7-28"><a href="backend-methods.html#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(w)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb7-29"><a href="backend-methods.html#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(rpos<span class="sc">&lt;</span>gff3[<span class="dv">1</span>,<span class="dv">4</span>]){    <span class="co">#rpos in the upstream of all gene</span></span>
<span id="cb7-30"><a href="backend-methods.html#cb7-30" aria-hidden="true" tabindex="-1"></a>        protein<span class="ot">&lt;-</span><span class="st">&quot;5&#39;UTR&quot;</span>;output<span class="ot">&lt;-</span><span class="fu">c</span>(rpos,<span class="st">&quot;extragenic&quot;</span>)</span>
<span id="cb7-31"><a href="backend-methods.html#cb7-31" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(rpos<span class="sc">&gt;</span>gff3[<span class="fu">nrow</span>(gff3),<span class="dv">5</span>]){  <span class="co">#?rpos in the downstream of all gene rpos&gt;gff3[nrow(gff3),5]</span></span>
<span id="cb7-32"><a href="backend-methods.html#cb7-32" aria-hidden="true" tabindex="-1"></a>        protein<span class="ot">&lt;-</span><span class="st">&quot;3&#39;UTR&quot;</span>;output<span class="ot">&lt;-</span><span class="fu">c</span>(rpos,<span class="st">&quot;extragenic&quot;</span>)</span>
<span id="cb7-33"><a href="backend-methods.html#cb7-33" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb7-34"><a href="backend-methods.html#cb7-34" aria-hidden="true" tabindex="-1"></a>        protein<span class="ot">&lt;-</span><span class="st">&quot;intergenic&quot;</span>;output<span class="ot">&lt;-</span><span class="fu">c</span>(rpos,<span class="st">&quot;extragenic&quot;</span>)</span>
<span id="cb7-35"><a href="backend-methods.html#cb7-35" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-36"><a href="backend-methods.html#cb7-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-37"><a href="backend-methods.html#cb7-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{ <span class="co"># Inside genes scenario</span></span>
<span id="cb7-38"><a href="backend-methods.html#cb7-38" aria-hidden="true" tabindex="-1"></a>      start<span class="ot">&lt;-</span>gff3[w,<span class="dv">4</span>]</span>
<span id="cb7-39"><a href="backend-methods.html#cb7-39" aria-hidden="true" tabindex="-1"></a>      end<span class="ot">&lt;-</span>gff3[w,<span class="dv">5</span>]</span>
<span id="cb7-40"><a href="backend-methods.html#cb7-40" aria-hidden="true" tabindex="-1"></a>      protein<span class="ot">&lt;-</span>gff3[w,<span class="dv">9</span>]</span>
<span id="cb7-41"><a href="backend-methods.html#cb7-41" aria-hidden="true" tabindex="-1"></a>      refdnaseq<span class="ot">&lt;-</span><span class="fu">DNAString</span>(<span class="fu">paste0</span>(refseq[start<span class="sc">:</span>end],<span class="at">collapse=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb7-42"><a href="backend-methods.html#cb7-42" aria-hidden="true" tabindex="-1"></a>      refpepseq<span class="ot">&lt;-</span>Biostrings<span class="sc">::</span><span class="fu">translate</span>(refdnaseq) <span class="co">#obtain protein seq</span></span>
<span id="cb7-43"><a href="backend-methods.html#cb7-43" aria-hidden="true" tabindex="-1"></a>      refpepseq<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">as.character</span>(refpepseq),<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-44"><a href="backend-methods.html#cb7-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(qvar<span class="sc">==</span><span class="st">&quot;.&quot;</span>){ <span class="co"># Deletion scenario</span></span>
<span id="cb7-45"><a href="backend-methods.html#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>((<span class="fu">nchar</span>(rvar)<span class="sc">%%</span><span class="dv">3</span>)<span class="sc">!=</span><span class="dv">0</span>){ <span class="co"># Deletion frameshift scenario</span></span>
<span id="cb7-46"><a href="backend-methods.html#cb7-46" aria-hidden="true" tabindex="-1"></a>          mutpos<span class="ot">&lt;-</span><span class="fu">round</span>((rpos<span class="sc">-</span>start<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb7-47"><a href="backend-methods.html#cb7-47" aria-hidden="true" tabindex="-1"></a>          output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refpepseq[mutpos],mutpos),<span class="st">&quot;deletion_frameshift&quot;</span>)</span>
<span id="cb7-48"><a href="backend-methods.html#cb7-48" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># In-frame deletion</span></span>
<span id="cb7-49"><a href="backend-methods.html#cb7-49" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>refseq</span>
<span id="cb7-50"><a href="backend-methods.html#cb7-50" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>varseq[<span class="sc">-</span>(rpos<span class="sc">:</span>(rpos<span class="sc">+</span><span class="fu">nchar</span>(rvar)<span class="sc">-</span><span class="dv">1</span>))]</span>
<span id="cb7-51"><a href="backend-methods.html#cb7-51" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>varseq[start<span class="sc">:</span>(end<span class="sc">-</span><span class="fu">nchar</span>(rvar))]</span>
<span id="cb7-52"><a href="backend-methods.html#cb7-52" aria-hidden="true" tabindex="-1"></a>          vardnaseq<span class="ot">&lt;-</span><span class="fu">DNAString</span>(<span class="fu">paste0</span>(varseq,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb7-53"><a href="backend-methods.html#cb7-53" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span>Biostrings<span class="sc">::</span><span class="fu">translate</span>(vardnaseq)</span>
<span id="cb7-54"><a href="backend-methods.html#cb7-54" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">as.character</span>(varpepseq),<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-55"><a href="backend-methods.html#cb7-55" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb7-56"><a href="backend-methods.html#cb7-56" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(refpepseq)){</span>
<span id="cb7-57"><a href="backend-methods.html#cb7-57" aria-hidden="true" tabindex="-1"></a>            refj<span class="ot">&lt;-</span>refpepseq[j]<span class="co">#</span></span>
<span id="cb7-58"><a href="backend-methods.html#cb7-58" aria-hidden="true" tabindex="-1"></a>            varj<span class="ot">&lt;-</span>varpepseq[j]</span>
<span id="cb7-59"><a href="backend-methods.html#cb7-59" aria-hidden="true" tabindex="-1"></a>            <span class="co">#fix 需要TRUE/FALSE值的地方不可以用缺少值</span></span>
<span id="cb7-60"><a href="backend-methods.html#cb7-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">is.na</span>(refj) <span class="sc">|</span> <span class="fu">is.na</span>(varj)){</span>
<span id="cb7-61"><a href="backend-methods.html#cb7-61" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refj,j),<span class="st">&quot;deletion&quot;</span>)</span>
<span id="cb7-62"><a href="backend-methods.html#cb7-62" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span>()</span>
<span id="cb7-63"><a href="backend-methods.html#cb7-63" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-64"><a href="backend-methods.html#cb7-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(refj<span class="sc">!=</span>varj){</span>
<span id="cb7-65"><a href="backend-methods.html#cb7-65" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span>(varj<span class="sc">==</span><span class="st">&quot;*&quot;</span>){</span>
<span id="cb7-66"><a href="backend-methods.html#cb7-66" aria-hidden="true" tabindex="-1"></a>                output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refj,j),<span class="st">&quot;deletion_stop&quot;</span>)</span>
<span id="cb7-67"><a href="backend-methods.html#cb7-67" aria-hidden="true" tabindex="-1"></a>              } <span class="cf">else</span> {</span>
<span id="cb7-68"><a href="backend-methods.html#cb7-68" aria-hidden="true" tabindex="-1"></a>                output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refj,j),<span class="st">&quot;deletion&quot;</span>)</span>
<span id="cb7-69"><a href="backend-methods.html#cb7-69" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb7-70"><a href="backend-methods.html#cb7-70" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span>()</span>
<span id="cb7-71"><a href="backend-methods.html#cb7-71" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-72"><a href="backend-methods.html#cb7-72" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-73"><a href="backend-methods.html#cb7-73" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-74"><a href="backend-methods.html#cb7-74" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(rvar<span class="sc">==</span><span class="st">&quot;.&quot;</span>){ <span class="co"># Insertion scenario</span></span>
<span id="cb7-75"><a href="backend-methods.html#cb7-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>((<span class="fu">nchar</span>(qvar)<span class="sc">%%</span><span class="dv">3</span>)<span class="sc">!=</span><span class="dv">0</span>){ <span class="co"># Insertion frameshift scenario</span></span>
<span id="cb7-76"><a href="backend-methods.html#cb7-76" aria-hidden="true" tabindex="-1"></a>          mutpos<span class="ot">&lt;-</span><span class="fu">round</span>((rpos<span class="sc">-</span>start<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb7-77"><a href="backend-methods.html#cb7-77" aria-hidden="true" tabindex="-1"></a>          output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refpepseq[mutpos],mutpos),<span class="st">&quot;insertion_frameshift&quot;</span>)</span>
<span id="cb7-78"><a href="backend-methods.html#cb7-78" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># In-frame insertion</span></span>
<span id="cb7-79"><a href="backend-methods.html#cb7-79" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span><span class="fu">c</span>(refseq[<span class="dv">1</span><span class="sc">:</span>rpos],<span class="fu">strsplit</span>(qvar,<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]],refseq[(rpos<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(refseq)])</span>
<span id="cb7-80"><a href="backend-methods.html#cb7-80" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>varseq[start<span class="sc">:</span>(end<span class="sc">+</span><span class="fu">nchar</span>(qvar))]</span>
<span id="cb7-81"><a href="backend-methods.html#cb7-81" aria-hidden="true" tabindex="-1"></a>          vardnaseq<span class="ot">&lt;-</span><span class="fu">DNAString</span>(<span class="fu">paste0</span>(varseq,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb7-82"><a href="backend-methods.html#cb7-82" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span>Biostrings<span class="sc">::</span><span class="fu">translate</span>(vardnaseq)</span>
<span id="cb7-83"><a href="backend-methods.html#cb7-83" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">as.character</span>(varpepseq),<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-84"><a href="backend-methods.html#cb7-84" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb7-85"><a href="backend-methods.html#cb7-85" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(refpepseq)){</span>
<span id="cb7-86"><a href="backend-methods.html#cb7-86" aria-hidden="true" tabindex="-1"></a>            refj<span class="ot">&lt;-</span>refpepseq[j]</span>
<span id="cb7-87"><a href="backend-methods.html#cb7-87" aria-hidden="true" tabindex="-1"></a>            varj<span class="ot">&lt;-</span>varpepseq[j]</span>
<span id="cb7-88"><a href="backend-methods.html#cb7-88" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fix 值</span></span>
<span id="cb7-89"><a href="backend-methods.html#cb7-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">is.na</span>(refj) <span class="sc">|</span> <span class="fu">is.na</span>(varj)){</span>
<span id="cb7-90"><a href="backend-methods.html#cb7-90" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refj,j),<span class="st">&quot;insertion&quot;</span>)</span>
<span id="cb7-91"><a href="backend-methods.html#cb7-91" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span>()</span>
<span id="cb7-92"><a href="backend-methods.html#cb7-92" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-93"><a href="backend-methods.html#cb7-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(refj<span class="sc">!=</span>varj){</span>
<span id="cb7-94"><a href="backend-methods.html#cb7-94" aria-hidden="true" tabindex="-1"></a>              nr_aa_inserted<span class="ot">&lt;-</span><span class="fu">nchar</span>(qvar)<span class="sc">/</span><span class="dv">3</span></span>
<span id="cb7-95"><a href="backend-methods.html#cb7-95" aria-hidden="true" tabindex="-1"></a>              multivarj<span class="ot">&lt;-</span>varpepseq[j<span class="sc">:</span>(j<span class="sc">+</span>nr_aa_inserted<span class="dv">-1</span>)]</span>
<span id="cb7-96"><a href="backend-methods.html#cb7-96" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span>(<span class="fu">any</span>(multivarj<span class="sc">==</span><span class="st">&quot;*&quot;</span>)){</span>
<span id="cb7-97"><a href="backend-methods.html#cb7-97" aria-hidden="true" tabindex="-1"></a>                multivarj<span class="ot">&lt;-</span><span class="fu">paste0</span>(multivarj,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb7-98"><a href="backend-methods.html#cb7-98" aria-hidden="true" tabindex="-1"></a>                output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(multivarj,j),<span class="st">&quot;insertion_stop&quot;</span>)</span>
<span id="cb7-99"><a href="backend-methods.html#cb7-99" aria-hidden="true" tabindex="-1"></a>              } <span class="cf">else</span>{</span>
<span id="cb7-100"><a href="backend-methods.html#cb7-100" aria-hidden="true" tabindex="-1"></a>                multivarj<span class="ot">&lt;-</span><span class="fu">paste0</span>(multivarj,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb7-101"><a href="backend-methods.html#cb7-101" aria-hidden="true" tabindex="-1"></a>                output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(multivarj,j),<span class="st">&quot;insertion&quot;</span>)</span>
<span id="cb7-102"><a href="backend-methods.html#cb7-102" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb7-103"><a href="backend-methods.html#cb7-103" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span>()</span>
<span id="cb7-104"><a href="backend-methods.html#cb7-104" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-105"><a href="backend-methods.html#cb7-105" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-106"><a href="backend-methods.html#cb7-106" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-107"><a href="backend-methods.html#cb7-107" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { <span class="co"># SNP scenario</span></span>
<span id="cb7-108"><a href="backend-methods.html#cb7-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">nchar</span>(qvar)<span class="sc">==</span><span class="dv">1</span>){ <span class="co"># ?Single nucleotide scenario </span></span>
<span id="cb7-109"><a href="backend-methods.html#cb7-109" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>refseq</span>
<span id="cb7-110"><a href="backend-methods.html#cb7-110" aria-hidden="true" tabindex="-1"></a>          varseq[rpos]<span class="ot">&lt;-</span>qvar</span>
<span id="cb7-111"><a href="backend-methods.html#cb7-111" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>varseq[start<span class="sc">:</span>end]</span>
<span id="cb7-112"><a href="backend-methods.html#cb7-112" aria-hidden="true" tabindex="-1"></a>          vardnaseq<span class="ot">&lt;-</span><span class="fu">DNAString</span>(<span class="fu">paste0</span>(varseq,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb7-113"><a href="backend-methods.html#cb7-113" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span>Biostrings<span class="sc">::</span><span class="fu">translate</span>(vardnaseq)</span>
<span id="cb7-114"><a href="backend-methods.html#cb7-114" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">as.character</span>(varpepseq),<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-115"><a href="backend-methods.html#cb7-115" aria-hidden="true" tabindex="-1"></a>          mutpos<span class="ot">&lt;-</span><span class="fu">which</span>(varpepseq<span class="sc">!=</span>refpepseq)  <span class="co">#split</span></span>
<span id="cb7-116"><a href="backend-methods.html#cb7-116" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">length</span>(mutpos)<span class="sc">==</span><span class="dv">0</span>){ <span class="co"># Silent SNP scenario</span></span>
<span id="cb7-117"><a href="backend-methods.html#cb7-117" aria-hidden="true" tabindex="-1"></a>            mutpos<span class="ot">&lt;-</span><span class="fu">round</span>((rpos<span class="sc">-</span>start<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb7-118"><a href="backend-methods.html#cb7-118" aria-hidden="true" tabindex="-1"></a>            refaa<span class="ot">&lt;-</span>refpepseq[mutpos]</span>
<span id="cb7-119"><a href="backend-methods.html#cb7-119" aria-hidden="true" tabindex="-1"></a>            varaa<span class="ot">&lt;-</span>varpepseq[mutpos]</span>
<span id="cb7-120"><a href="backend-methods.html#cb7-120" aria-hidden="true" tabindex="-1"></a>            output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos,varaa),<span class="st">&quot;SNP_silent&quot;</span>)</span>
<span id="cb7-121"><a href="backend-methods.html#cb7-121" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> { <span class="co"># Changed aa scenario</span></span>
<span id="cb7-122"><a href="backend-methods.html#cb7-122" aria-hidden="true" tabindex="-1"></a>            refaa<span class="ot">&lt;-</span>refpepseq[mutpos]</span>
<span id="cb7-123"><a href="backend-methods.html#cb7-123" aria-hidden="true" tabindex="-1"></a>            varaa<span class="ot">&lt;-</span>varpepseq[mutpos]</span>
<span id="cb7-124"><a href="backend-methods.html#cb7-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(varaa<span class="sc">==</span><span class="st">&quot;*&quot;</span>){</span>
<span id="cb7-125"><a href="backend-methods.html#cb7-125" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos,varaa),<span class="st">&quot;SNP_stop&quot;</span>)</span>
<span id="cb7-126"><a href="backend-methods.html#cb7-126" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb7-127"><a href="backend-methods.html#cb7-127" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos,varaa),<span class="st">&quot;SNP&quot;</span>)</span>
<span id="cb7-128"><a href="backend-methods.html#cb7-128" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-129"><a href="backend-methods.html#cb7-129" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-130"><a href="backend-methods.html#cb7-130" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># Multiple neighboring nucleotides</span></span>
<span id="cb7-131"><a href="backend-methods.html#cb7-131" aria-hidden="true" tabindex="-1"></a>          varlength<span class="ot">&lt;-</span><span class="fu">nchar</span>(qvar)</span>
<span id="cb7-132"><a href="backend-methods.html#cb7-132" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>refseq</span>
<span id="cb7-133"><a href="backend-methods.html#cb7-133" aria-hidden="true" tabindex="-1"></a>          varseq[rpos<span class="sc">:</span>(rpos<span class="sc">+</span>varlength<span class="dv">-1</span>)]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(qvar,<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-134"><a href="backend-methods.html#cb7-134" aria-hidden="true" tabindex="-1"></a>          varseq<span class="ot">&lt;-</span>varseq[start<span class="sc">:</span>end]</span>
<span id="cb7-135"><a href="backend-methods.html#cb7-135" aria-hidden="true" tabindex="-1"></a>          vardnaseq<span class="ot">&lt;-</span><span class="fu">DNAString</span>(<span class="fu">paste0</span>(varseq,<span class="at">collapse=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb7-136"><a href="backend-methods.html#cb7-136" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span>Biostrings<span class="sc">::</span><span class="fu">translate</span>(vardnaseq)</span>
<span id="cb7-137"><a href="backend-methods.html#cb7-137" aria-hidden="true" tabindex="-1"></a>          varpepseq<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">as.character</span>(varpepseq),<span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb7-138"><a href="backend-methods.html#cb7-138" aria-hidden="true" tabindex="-1"></a>          mutpos<span class="ot">&lt;-</span><span class="fu">which</span>(varpepseq<span class="sc">!=</span>refpepseq)</span>
<span id="cb7-139"><a href="backend-methods.html#cb7-139" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">length</span>(mutpos)<span class="sc">==</span><span class="dv">0</span>){ <span class="co"># Silent SNP scenario</span></span>
<span id="cb7-140"><a href="backend-methods.html#cb7-140" aria-hidden="true" tabindex="-1"></a>            mutpos<span class="ot">&lt;-</span><span class="fu">round</span>((rpos<span class="sc">-</span>start<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb7-141"><a href="backend-methods.html#cb7-141" aria-hidden="true" tabindex="-1"></a>            refaa<span class="ot">&lt;-</span>refpepseq[mutpos]</span>
<span id="cb7-142"><a href="backend-methods.html#cb7-142" aria-hidden="true" tabindex="-1"></a>            varaa<span class="ot">&lt;-</span>varpepseq[mutpos]</span>
<span id="cb7-143"><a href="backend-methods.html#cb7-143" aria-hidden="true" tabindex="-1"></a>            output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos,varaa),<span class="st">&quot;SNP_silent&quot;</span>)</span>
<span id="cb7-144"><a href="backend-methods.html#cb7-144" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> { <span class="co"># Changed aa scenario</span></span>
<span id="cb7-145"><a href="backend-methods.html#cb7-145" aria-hidden="true" tabindex="-1"></a>            refaa<span class="ot">&lt;-</span><span class="fu">paste0</span>(refpepseq[mutpos],<span class="at">collapse=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb7-146"><a href="backend-methods.html#cb7-146" aria-hidden="true" tabindex="-1"></a>            varaa<span class="ot">&lt;-</span><span class="fu">paste0</span>(varpepseq[mutpos],<span class="at">collapse=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb7-147"><a href="backend-methods.html#cb7-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(varaa<span class="sc">==</span><span class="st">&quot;*&quot;</span>)){</span>
<span id="cb7-148"><a href="backend-methods.html#cb7-148" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos[<span class="dv">1</span>],varaa),<span class="st">&quot;SNP_stop&quot;</span>)</span>
<span id="cb7-149"><a href="backend-methods.html#cb7-149" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb7-150"><a href="backend-methods.html#cb7-150" aria-hidden="true" tabindex="-1"></a>              output<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">paste0</span>(refaa,mutpos[<span class="dv">1</span>],varaa),<span class="st">&quot;SNP&quot;</span>)</span>
<span id="cb7-151"><a href="backend-methods.html#cb7-151" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-152"><a href="backend-methods.html#cb7-152" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb7-153"><a href="backend-methods.html#cb7-153" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-154"><a href="backend-methods.html#cb7-154" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-155"><a href="backend-methods.html#cb7-155" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-156"><a href="backend-methods.html#cb7-156" aria-hidden="true" tabindex="-1"></a>    results<span class="ot">&lt;-</span><span class="fu">rbind</span>(results,<span class="fu">c</span>(sample,rpos,rvar,qvar,qpos,qlength,protein,output,annot[protein]))</span>
<span id="cb7-157"><a href="backend-methods.html#cb7-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-158"><a href="backend-methods.html#cb7-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setTxtProgressBar</span>(pb,pbi)</span>
<span id="cb7-159"><a href="backend-methods.html#cb7-159" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I used GFF3 table to search for gene region for each record. To avoid traversing GFF3 each time, we rewrote the traversing part into static index (hash table), in which 1 ~ 30000 genomic coordinates are mapped to gene region and protein group. This index only took up several hundred kilobyte.</p>
<p>In java, <code>stream()</code> mode can be switched to <code>parallel</code> mode to achieve parallel computing:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="backend-methods.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>mutpos<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="backend-methods.html#cb8-2" aria-hidden="true" tabindex="-1"></a>                            var mp <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span><span class="op">((</span>rpos <span class="op">-</span> ge<span class="op">.</span><span class="fu">getStPos</span><span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3.0f</span><span class="op">);</span></span>
<span id="cb8-3"><a href="backend-methods.html#cb8-3" aria-hidden="true" tabindex="-1"></a>                            mutpos<span class="op">.</span><span class="fu">add</span><span class="op">(</span>mp<span class="op">);</span></span>
<span id="cb8-4"><a href="backend-methods.html#cb8-4" aria-hidden="true" tabindex="-1"></a>                            varaa <span class="op">=</span> varPepSeq<span class="op">.</span><span class="fu">getCompoundAt</span><span class="op">(</span>mp<span class="op">).</span><span class="fu">toString</span><span class="op">();</span></span>
<span id="cb8-5"><a href="backend-methods.html#cb8-5" aria-hidden="true" tabindex="-1"></a>                            sae<span class="op">.</span><span class="fu">setVarclass</span><span class="op">(</span><span class="st">&quot;SNP_silent&quot;</span><span class="op">);</span></span>
<span id="cb8-6"><a href="backend-methods.html#cb8-6" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb8-7"><a href="backend-methods.html#cb8-7" aria-hidden="true" tabindex="-1"></a>                            varaa <span class="op">=</span> StrUtil<span class="op">.</span><span class="fu">join</span><span class="op">(</span>StrUtil<span class="op">.</span><span class="fu">EMPTY</span><span class="op">,</span></span>
<span id="cb8-8"><a href="backend-methods.html#cb8-8" aria-hidden="true" tabindex="-1"></a>                                    mutpos<span class="op">.</span><span class="fu">stream</span><span class="op">().</span><span class="fu">map</span><span class="op">(</span>varPepSeq<span class="op">::</span>getCompoundAt<span class="op">).</span><span class="fu">collect</span><span class="op">(</span>Collectors<span class="op">.</span><span class="fu">toList</span><span class="op">()));</span></span>
<span id="cb8-9"><a href="backend-methods.html#cb8-9" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="op">(</span>varaa<span class="op">.</span><span class="fu">contains</span><span class="op">(</span><span class="st">&quot;*&quot;</span><span class="op">))</span></span>
<span id="cb8-10"><a href="backend-methods.html#cb8-10" aria-hidden="true" tabindex="-1"></a>                                sae<span class="op">.</span><span class="fu">setVarclass</span><span class="op">(</span><span class="st">&quot;SNP_STOP&quot;</span><span class="op">);</span></span>
<span id="cb8-11"><a href="backend-methods.html#cb8-11" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span></span>
<span id="cb8-12"><a href="backend-methods.html#cb8-12" aria-hidden="true" tabindex="-1"></a>                                sae<span class="op">.</span><span class="fu">setVarclass</span><span class="op">(</span><span class="st">&quot;SNP&quot;</span><span class="op">);</span></span>
<span id="cb8-13"><a href="backend-methods.html#cb8-13" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="cb8-14"><a href="backend-methods.html#cb8-14" aria-hidden="true" tabindex="-1"></a>                        sae<span class="op">.</span><span class="fu">setVariant</span><span class="op">(</span></span>
<span id="cb8-15"><a href="backend-methods.html#cb8-15" aria-hidden="true" tabindex="-1"></a>                                StrUtil<span class="op">.</span><span class="fu">join</span><span class="op">(</span>StrUtil<span class="op">.</span><span class="fu">EMPTY</span><span class="op">,</span> mutpos<span class="op">.</span><span class="fu">stream</span><span class="op">().</span><span class="fu">map</span><span class="op">(</span>refPepSeq<span class="op">::</span>getCompoundAt<span class="op">).</span><span class="fu">collect</span><span class="op">(</span>Collectors<span class="op">.</span><span class="fu">toList</span><span class="op">()))</span></span>
<span id="cb8-16"><a href="backend-methods.html#cb8-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="op">+</span> mutpos<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">+</span> varaa<span class="op">);</span></span>
<span id="cb8-17"><a href="backend-methods.html#cb8-17" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb8-18"><a href="backend-methods.html#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb8-19"><a href="backend-methods.html#cb8-19" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> also use hash table <span class="co">(</span>codon table<span class="co">)</span> to map mutated trinucleotide to amino acid<span class="co">.</span></span>
<span id="cb8-20"><a href="backend-methods.html#cb8-20" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>return</span>
<span id="cb8-21"><a href="backend-methods.html#cb8-21" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span></code></pre></div>
<p>One notable thing is that the division operation can be different between R and java when rewriting code. In R:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="backend-methods.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb9-2"><a href="backend-methods.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 2.666667</span></span></code></pre></div>
<p>In java:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="backend-methods.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="op">/</span><span class="dv">3</span></span>
<span id="cb10-2"><a href="backend-methods.html#cb10-2" aria-hidden="true" tabindex="-1"></a># <span class="dv">2</span></span></code></pre></div>
<p>In some cases, this can lead to serious problems. Instead of <code>8/3</code>, you should write: <code>8/3.0</code>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Mercatelli2020" class="csl-entry">
Mercatelli, Daniele, and Federico Manuel Giorgi. 2020. <em>Geographic and Genomic Distribution of SARS-CoV-2 Mutations</em>. <a href="https://doi.org/10.20944/preprints202004.0529.v1">https://doi.org/10.20944/preprints202004.0529.v1</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="possible-solutions-for-the-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="front-end-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["msq_books.pdf", "msq_books.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
